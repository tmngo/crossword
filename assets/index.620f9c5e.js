import{S as t,i as o,s as e,e as n,a as l,b as a,l as s,n as i,d as r,r as c,c as d,o as u,f,t as h,g,h as p,j as m,k as v,m as b,p as w,q as x,u as B,v as A,w as _,x as R,y as E,z as y,A as S,B as C,C as T}from"./vendor.f1f65b7f.js";var L,D,P,O,z,I,U,k,W,N;(D=L||(L={}))[D.Text=0]="Text",D[D.Puzzle=1]="Puzzle",D[D.Register=2]="Register",D[D.State=3]="State",D[D.PLAYER_UPDATE=4]="PLAYER_UPDATE",D[D.PLAYER_ACTION=5]="PLAYER_ACTION",D[D.PLAYER_CLICK=6]="PLAYER_CLICK",D[D.PUZZLE_LOAD=7]="PUZZLE_LOAD",D[D.NEW_PUZZLE=8]="NEW_PUZZLE",(O=P||(P={}))[O.WALL_STREET_JOURNAL=0]="WALL_STREET_JOURNAL",(I=z||(z={}))[I.ACROSS=0]="ACROSS",I[I.DOWN=1]="DOWN",(k=U||(U={})).ARROW_DOWN="ArrowDown",k.ARROW_LEFT="ArrowLeft",k.ARROW_UP="ArrowUp",k.ARROW_RIGHT="ArrowRight",k.BACKSPACE="Backspace",k.DELETE="Delete",k.SPACE=" ",(N=W||(W={}))[N.CROSSWORD=0]="CROSSWORD",N[N.LIST=1]="LIST";const M=(t,o)=>{const{row:e,col:n,dir:l}=o,{acrossClues:a,downClues:s}=t;return l===z.ACROSS?a.find((t=>e===t.row&&n>=t.column&&n<=t.column+t.length)):s.find((t=>n===t.column&&e>=t.row&&e<=t.row+t.length))},Y=(t,o,e)=>{const n=t.createShader(o);if(!n)return null;t.shaderSource(n,e),t.compileShader(n);return t.getShaderParameter(n,t.COMPILE_STATUS)?n:(console.log(t.getShaderInfoLog(n)),t.deleteShader(n),null)},F={atlas:{type:"msdf",distanceRange:2,size:32,width:152,height:152,yOrigin:"bottom"},metrics:{emSize:1,lineHeight:1.24,ascender:.9500000000000001,descender:-.29,underlineY:-.106,underlineThickness:.057},glyphs:{"":{atlasBounds:{left:.5,bottom:.5,right:.5,top:2.5}},".":{atlasBounds:{left:3.5,bottom:144.5,right:3.5,top:144.5}},0:{unicode:48,advance:.648,planeBounds:{left:.027125000000000014,bottom:-.056624999999999974,right:.6208750000000001,top:.724625},atlasBounds:{left:74.5,bottom:101.5,right:93.5,top:126.5}},1:{unicode:49,advance:.402,planeBounds:{left:.001125000000000007,bottom:-.04099999999999998,right:.344875,top:.709},atlasBounds:{left:30.5,bottom:.5,right:41.5,top:24.5}},2:{unicode:50,advance:.549,planeBounds:{left:-.006750000000000007,bottom:-.034999999999999976,right:.55575,top:.715},atlasBounds:{left:95.5,bottom:102.5,right:113.5,top:126.5}},3:{unicode:51,advance:.5740000000000001,planeBounds:{left:-.0032500000000000107,bottom:-.056624999999999974,right:.55925,top:.724625},atlasBounds:{left:95.5,bottom:76.5,right:113.5,top:101.5}},4:{unicode:52,advance:.614,planeBounds:{left:-.005499999999999982,bottom:-.04099999999999998,right:.6195,top:.709},atlasBounds:{left:53.5,bottom:127.5,right:73.5,top:151.5}},5:{unicode:53,advance:.583,planeBounds:{left:.021874999999999985,bottom:-.04699999999999997,right:.553125,top:.7030000000000001},atlasBounds:{left:114.5,bottom:76.5,right:131.5,top:100.5}},6:{unicode:54,advance:.598,planeBounds:{left:.017749999999999988,bottom:-.056624999999999974,right:.58025,top:.724625},atlasBounds:{left:95.5,bottom:50.5,right:113.5,top:75.5}},7:{unicode:55,advance:.51,planeBounds:{left:-.020125000000000014,bottom:-.04099999999999998,right:.511125,top:.709},atlasBounds:{left:114.5,bottom:101.5,right:131.5,top:125.5}},8:{unicode:56,advance:.615,planeBounds:{left:.026249999999999996,bottom:-.056624999999999974,right:.58875,top:.724625},atlasBounds:{left:114.5,bottom:126.5,right:132.5,top:151.5}},9:{unicode:57,advance:.598,planeBounds:{left:.017749999999999988,bottom:-.03549999999999997,right:.58025,top:.7145},atlasBounds:{left:95.5,bottom:25.5,right:113.5,top:49.5}},A:{unicode:65,advance:.626,planeBounds:{left:-.030750000000000006,bottom:-.04049999999999998,right:.6567500000000001,top:.7095},atlasBounds:{left:.5,bottom:24.5,right:22.5,top:48.5}},B:{unicode:66,advance:.619,planeBounds:{left:.03162500000000001,bottom:-.04099999999999998,right:.625375,top:.709},atlasBounds:{left:74.5,bottom:26.5,right:93.5,top:50.5}},C:{unicode:67,advance:.656,planeBounds:{left:.005875000000000032,bottom:-.056624999999999974,right:.662125,top:.724625},atlasBounds:{left:30.5,bottom:76.5,right:51.5,top:101.5}},D:{unicode:68,advance:.673,planeBounds:{left:.03700000000000002,bottom:-.04099999999999998,right:.662,top:.709},atlasBounds:{left:53.5,bottom:27.5,right:73.5,top:51.5}},E:{unicode:69,advance:.5670000000000001,planeBounds:{left:.03687499999999998,bottom:-.04099999999999998,right:.568125,top:.709},atlasBounds:{left:114.5,bottom:51.5,right:131.5,top:75.5}},F:{unicode:70,advance:.548,planeBounds:{left:.043000000000000003,bottom:-.04099999999999998,right:.543,top:.709},atlasBounds:{left:114.5,bottom:1.5,right:130.5,top:25.5}},G:{unicode:71,advance:.71,planeBounds:{left:.017874999999999985,bottom:-.056624999999999974,right:.674125,top:.724625},atlasBounds:{left:30.5,bottom:50.5,right:51.5,top:75.5}},H:{unicode:72,advance:.6900000000000001,planeBounds:{left:.032500000000000015,bottom:-.04099999999999998,right:.6575,top:.709},atlasBounds:{left:74.5,bottom:127.5,right:94.5,top:151.5}},I:{unicode:73,advance:.41400000000000003,planeBounds:{left:.019500000000000014,bottom:-.04099999999999998,right:.3945,top:.709},atlasBounds:{left:95.5,bottom:.5,right:107.5,top:24.5}},J:{unicode:74,advance:.51,planeBounds:{left:-.02550000000000001,bottom:-.04699999999999997,right:.47450000000000003,top:.7030000000000001},atlasBounds:{left:133.5,bottom:127.5,right:149.5,top:151.5}},K:{unicode:75,advance:.627,planeBounds:{left:.034000000000000016,bottom:-.04099999999999998,right:.659,top:.709},atlasBounds:{left:53.5,bottom:2.5,right:73.5,top:26.5}},L:{unicode:76,advance:.539,planeBounds:{left:.03687499999999998,bottom:-.04099999999999998,right:.568125,top:.709},atlasBounds:{left:114.5,bottom:26.5,right:131.5,top:50.5}},M:{unicode:77,advance:.8200000000000001,planeBounds:{left:.035000000000000024,bottom:-.04099999999999998,right:.785,top:.709},atlasBounds:{left:.5,bottom:75.5,right:24.5,top:99.5}},N:{unicode:78,advance:.6890000000000001,planeBounds:{left:.032000000000000015,bottom:-.04099999999999998,right:.657,top:.709},atlasBounds:{left:53.5,bottom:77.5,right:73.5,top:101.5}},O:{unicode:79,advance:.727,planeBounds:{left:.004125,bottom:-.056624999999999974,right:.722875,top:.724625},atlasBounds:{left:.5,bottom:49.5,right:23.5,top:74.5}},P:{unicode:80,advance:.601,planeBounds:{left:.03825,bottom:-.04049999999999999,right:.60075,top:.7095},atlasBounds:{left:95.5,bottom:127.5,right:113.5,top:151.5}},Q:{unicode:81,advance:.753,planeBounds:{left:.010875000000000036,bottom:-.08825000000000002,right:.792125,top:.7242500000000001},atlasBounds:{left:.5,bottom:100.5,right:25.5,top:126.5}},R:{unicode:82,advance:.618,planeBounds:{left:.03512500000000001,bottom:-.04099999999999998,right:.628875,top:.709},atlasBounds:{left:74.5,bottom:51.5,right:93.5,top:75.5}},S:{unicode:83,advance:.596,planeBounds:{left:.001125000000000007,bottom:-.056624999999999974,right:.594875,top:.724625},atlasBounds:{left:74.5,bottom:.5,right:93.5,top:25.5}},T:{unicode:84,advance:.558,planeBounds:{left:-.03349999999999999,bottom:-.04099999999999998,right:.5915,top:.709},atlasBounds:{left:53.5,bottom:102.5,right:73.5,top:126.5}},U:{unicode:85,advance:.6900000000000001,planeBounds:{left:.032500000000000015,bottom:-.04699999999999997,right:.6575,top:.7030000000000001},atlasBounds:{left:53.5,bottom:52.5,right:73.5,top:76.5}},V:{unicode:86,advance:.589,planeBounds:{left:-.033624999999999974,bottom:-.04099999999999998,right:.622625,top:.709},atlasBounds:{left:30.5,bottom:102.5,right:51.5,top:126.5}},W:{unicode:87,advance:.84,planeBounds:{left:-.033124999999999974,bottom:-.04099999999999998,right:.873125,top:.709},atlasBounds:{left:.5,bottom:127.5,right:29.5,top:151.5}},X:{unicode:88,advance:.623,planeBounds:{left:-.032250000000000015,bottom:-.04099999999999998,right:.65525,top:.709},atlasBounds:{left:30.5,bottom:127.5,right:52.5,top:151.5}},Y:{unicode:89,advance:.595,planeBounds:{left:-.030624999999999965,bottom:-.04099999999999998,right:.625625,top:.709},atlasBounds:{left:30.5,bottom:25.5,right:51.5,top:49.5}},Z:{unicode:90,advance:.607,planeBounds:{left:.006625000000000011,bottom:-.04099999999999998,right:.600375,top:.709},atlasBounds:{left:74.5,bottom:76.5,right:93.5,top:100.5}}},kerning:[]};function $(t){let o,e,d;return{c(){o=n("canvas"),l(o,"id","canvas"),l(o,"class","svelte-w4tyox")},m(n,l){a(n,o,l),t[10](o),e||(d=[s(window,"keydown",t[3]),s(window,"resize",t[9]),s(o,"click",t[2])],e=!0)},p:i,i:i,o:i,d(n){n&&r(o),t[10](null),e=!1,c(d)}}}function Z(t,o,e){const{atlas:n,glyphs:l}=F;let{cells:a=[]}=o,{puzzle:s}=o,{playerId:i}=o,{playerMap:r}=o;const c=d();let h,g,p,m,v={i:-1,j:-1},b=[];const w=(t,o,e,n,l,a,s)=>{const i=.04/e,r=(1-i)*(2*n/e-1),c=(1-i)*(2*l/e-1),d=(1-i)*(1-2*s/o),u=(1-i)*(1-2*a/o);t.push(r,d,r,u,c,u,r,d,c,u,c,d)},x=()=>{const t=[];return B(t,s),A(t,s),_(t,s),t},B=(t,o)=>{const{grid:e,height:n,width:l}=o;for(let a=0;a<n;a++)for(let o=0;o<l;o++){const e=.02;w(t,n,l,o+e,o+1-e,a+e,a+1-e)}},A=(t,o)=>{const{grid:e,height:s,width:i}=o;for(let r=0;r<s;r++)for(let o=0;o<i;o++){const c=r*i+o;if("."===e[c]){w(t,s,i,o,o+1,r,r+1);continue}const{atlasBounds:{left:d,bottom:u,right:f,top:h}}=l[a[c].value],g=.75,p=(h-u-2)/n.size*g,m=(f-d-2)/n.size*g,v=.3;w(t,s,i,o+.5-m/2,o+.5+m/2,r+1-(1+v)*p,r+1-v*p)}},_=(t,o)=>{const{grid:e,height:a,width:s}=o;let i=1;for(let r=0;r<a;r++)for(let o=0;o<s;o++){const c=r*s+o,d="."===e[c],u=0===o||"."===e[c-1],f=0===r||"."===e[c-s];if(d||!u&&!f)continue;const h=i.toString(),g=.05;let p=o+g,m=o+g;for(let o=0;o<h.length;o++){const{atlasBounds:{left:e,bottom:i,right:c,top:d}}=l[h[o]],u=(d-i)/n.size/4,f=(c-e)/n.size/4;m+=f;w(t,a,s,p,m,r+g,r+g+u),p+=f}i+=1}},R=()=>{const t=[];return E(t,s),y(t,s),S(t,s),t},E=(t,o)=>{const{grid:e,height:a,width:s}=o;for(let i=0;i<a;i++)for(let o=0;o<s;o++){const{atlasBounds:{left:o,bottom:e,right:a,top:s}}=l[""],i=o/n.width,r=(n.width-e)/n.width,c=a/n.width,d=(n.width-s)/n.width;t.push(i,r,i,d,c,d,i,r,c,d,c,r)}},y=(t,o)=>{const{grid:e,height:s,width:i}=o;for(let r=0;r<s;r++)for(let o=0;o<i;o++){const s=r*i+o,c="."===e[s]?".":a[s].value,{atlasBounds:{left:d,bottom:u,right:f,top:h}}=l[c],g=d/n.width,p=(n.width-u)/n.width,m=f/n.width,v=(n.width-h)/n.width;t.push(g,p,g,v,m,v,g,p,m,v,m,p)}},S=(t,o)=>{const{height:e,width:a,grid:s}=o;let i=1;for(let r=0;r<e;r++)for(let o=0;o<a;o++){const e=r*a+o,c="."===s[e],d=0===o||"."===s[e-1],u=0===r||"."===s[e-a];if(c||!d&&!u)continue;const f=i.toString();for(let o=0;o<f.length;o++){const{atlasBounds:{left:e,bottom:a,right:s,top:i}}=l[f[o]];let r=n.width;const c=0,d=e/r,u=(r-a-c)/r,h=s/r,g=(r-i+c)/r;t.push(d,u,d,g,h,g,d,u,h,g,h,u)}i+=1}},C=()=>{const t=[];return T(t,s),L(t,s),D(t,s),t},T=(t,o)=>{const{height:e,width:n,grid:l}=o;for(let a=0;a<e;a++)for(let o=0;o<n;o++){const e=b[a*n+o],{r:l,g:s,b:i,a:r}=e;for(let o=0;o<6;o++)t.push(l,s,i,r)}},L=(t,o)=>{const{height:e,width:n,grid:l}=o;for(let a=0;a<e;a++)for(let o=0;o<n;o++){const o={r:0,g:0,b:0,a:0},{r:e,g:n,b:l,a:a}=o;for(let s=0;s<6;s++)t.push(e,n,l,a)}},D=(t,o)=>{const{height:e,width:n,grid:l}=o;for(let a=0;a<e;a++)for(let o=0;o<n;o++){const o=[0,0,0,0];for(let e=0;e<6;e++)t.push(...o)}},P=()=>{e(4,s);const{height:t,width:o}=s;e(8,b=Array(t*o));for(let n=0;n<t;n++)for(let t=0;t<o;t++){e(8,b[n*o+t]={r:1,g:1,b:1,a:1},b)}};u((()=>{console.log("--- Begin onMount."),p=g.getContext("webgl2");const t=Y(p,p.VERTEX_SHADER,"#version 300 es\n\n// An attribute is an input to a vertex shader.\n// It will receive data from a buffer.\nin vec4 a_position;\nin vec2 a_texcoord;\nin vec4 a_color;\n\n// Translation to add to position\nuniform vec2 u_translation;\n\nout highp vec2 v_texcoord;\nout highp vec4 v_color;\n\n// All shaders have a main function.\nvoid main() {\n\n  vec4 position = a_position + vec4(u_translation, 0, 0);\n\n  // gl_Position is a special variable a vertex shader is responsible for setting\n  gl_Position = position;\n\n  v_texcoord = a_texcoord;\n  v_color = a_color;\n}\n"),o=Y(p,p.FRAGMENT_SHADER,"#version 300 es\n\n// Fragment shaders don't have a default precision so we need to pick one.\n// highp (high precision) is a good default.\nprecision highp float;\n\nin highp vec2 v_texcoord;\nin highp vec4 v_color;\n\n// Take a uniform color input.\nuniform vec3 u_color;\n\nuniform sampler2D u_texture;\n\n// We need to declare an output for the fragment shader.\nout vec4 outColor;\n\nfloat median(float r, float g, float b) {\n  return max(min(r, g), min(max(r, g), b));\n}\n\n\n// void main() {\n//   vec4 texColor = texture(u_texture, v_texcoord);\n//   float sigDist = median(texColor.r, texColor.g, texColor.b) - 0.5;\n\n//   float alpha = clamp(sigDist / fwidth(sigDist) + 0.5, 0.0, 1.0);\n  \n//   // float alpha = sigDist > 0.0 ? 1.0 : 0.0;\n\n//   // vec2 ddist = vec2(dFdx(sigDist), dFdy(sigDist));\n//   // float alpha = sigDist / length(ddist) + 0.5;\n//   // float alpha = clamp(sigDist / length(ddist) + 0.5, 0.0, 1.0);\n\n//   outColor = mix(vec4(u_color, 1.0), vec4(0.0, 0.0, 0.0, 0.0),  1.0-alpha);\n  \n//   if (outColor.a < 0.0001) discard;\n// }\n\nfloat screenPxRange() {\n  return 6.0;\n}\n\nfloat norm(float x, float a, float b) {\n  return b != a ? (x - a) / (b - a) : 0.0;\n}\n\nfloat fitClamped(float x, float a, float b, float c, float d) {\n  return c + (d - c) * clamp(norm(x, a, b), 0.0, 1.0);\n}\n\nvoid main() {\n  const vec4 bgColor = vec4(0.0, 0.0, 0.0, 0.0);\n  vec3 msd = texture(u_texture, v_texcoord).rgb;\n  float sd = median(msd.r, msd.g, msd.b);\n\n  // Original\n  \n  // float screenPxDistance = screenPxRange()*(sd - 0.5);\n  // float opacity = clamp(screenPxDistance + 0.5, 0.0, 1.0);\n  // outColor = mix(v_color, vec4(u_color, 1.0), opacity);\n\n  // https://observablehq.com/@stwind/msdf-text-label\n  \n  vec2 duv = fwidth(v_texcoord);\n  // antialising factor\n  float su = 0.0078125;\n  float aa = max(dot(vec2(su), 0.5 / duv), 1.0);\n  // edge boosting for low resolutions\n  float boost = fitClamped(0.5 * su / length(duv), 1.0, 0.5, 0.0, 0.5);\n  float t = clamp((sd - 0.5) * aa + 0.5, 0.0, 1.0);\n  t = norm(t, 0.0, 1.0 - boost);\n  outColor = mix(v_color, vec4(u_color, 1.0), t);\n}\n\n\n\n"),e=((t,o,e)=>{const n=t.createProgram();return n?(t.attachShader(n,o),t.attachShader(n,e),t.linkProgram(n),t.getProgramParameter(n,t.LINK_STATUS)?n:(console.log(t.getProgramInfoLog(n)),t.deleteProgram(n),null)):null})(p,t,o),n=[{name:"a_position",size:2,normalized:!1},{name:"a_texcoord",size:2,normalized:!0},{name:"a_color",size:4,normalized:!1}],l=p.getUniformLocation(e,"u_color"),a=p.getUniformLocation(e,"u_translation"),s=p.createVertexArray();p.bindVertexArray(s);const i=[];for(let d=0;d<n.length;d++){const{name:t,size:o,normalized:l}=n[d],a=p.getAttribLocation(e,t),s=p.createBuffer();p.bindBuffer(p.ARRAY_BUFFER,s),p.enableVertexAttribArray(a),p.vertexAttribPointer(a,o,p.FLOAT,l,0,0),i.push(s)}const r=p.createTexture();p.activeTexture(p.TEXTURE0+0),p.bindTexture(p.TEXTURE_2D,r),p.texImage2D(p.TEXTURE_2D,0,p.RGBA,1,1,0,p.RGBA,p.UNSIGNED_BYTE,new Uint8Array([0,0,255,255]));const c=new Image;c.src="src/assets/msdf-32-2.png",c.addEventListener("load",(()=>{p.bindTexture(p.TEXTURE_2D,r),p.texImage2D(p.TEXTURE_2D,0,p.RGBA,p.RGBA,p.UNSIGNED_BYTE,c),p.generateMipmap(p.TEXTURE_2D),m(p)})),p.useProgram(e),p.enable(p.BLEND),p.blendFunc(p.SRC_ALPHA,p.ONE_MINUS_SRC_ALPHA),m=t=>{((t,o)=>{o=o||1;const e=t.clientWidth*o|0,n=t.clientHeight*o|0;(t.width!==e||t.height!==n)&&(t.width=e,t.height=n)})(t.canvas,2),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.bindVertexArray(s);const o=[x(),R(),C()];for(let l=0;l<i.length;l++)t.bindBuffer(t.ARRAY_BUFFER,i[l]),t.bufferData(t.ARRAY_BUFFER,new Float32Array(o[l]),t.STATIC_DRAW);const e=[[0,0,0],[0,0]];t.uniform3fv(l,e[0]),t.uniform2fv(a,e[1]);const n=t.TRIANGLES,r=o[0].length/2;t.drawArrays(n,0,r)},m(p),console.log("--- End onMount.")})),h=((t,o)=>{let e;return()=>{clearTimeout(e),e=setTimeout((()=>{t()}),o)}})((()=>{m(p),console.log("draw")}),1e3);const O=(t,o,n)=>{const{grid:l,height:a,width:c}=s;if(t<0||o<0||t>=a||o>=c)return!1;const d=null==r?void 0:r.get(i);if(!d)return!1;const{position:{row:u,col:f}}=d;for(console.log({player:d});"."===l[t*c+o];)if(o===f)if(t>u&&t<a-1)t+=1;else{if(!(t<u&&t>0))return!1;t-=1}else if(t===u)if(o>f&&o<c-1)o+=1;else{if(!(o<f&&o>0))return!1;o-=1}return r.set(i,Object.assign(Object.assign({},d),{position:{row:t,col:o,dir:n}})),I(r),e(5,r),console.log({playerMap:r}),!0},I=t=>{if(console.log("updateColors"),!t)return;const{width:o}=s;for(const[n,l]of t){const{color:t,position:n}=l,{row:a,col:i,dir:r}=n;if(a<0||i<0||0===s.acrossClues.length)continue;const c=M(s,n);for(let l=0;l<c.length;l++){const n=r===z.ACROSS?c.row*o+c.column+l:(c.row+l)*o+c.column;e(8,b[n]=t,b)}e(8,b[a*o+i]={r:Math.pow(t.r,.3),g:Math.pow(t.g,.3),b:Math.pow(t.b,.3),a:1},b)}null==m||m(p)};return t.$$set=t=>{"cells"in t&&e(6,a=t.cells),"puzzle"in t&&e(4,s=t.puzzle),"playerId"in t&&e(7,i=t.playerId),"playerMap"in t&&e(5,r=t.playerMap)},t.$$.update=()=>{17&t.$$.dirty[0]&&(console.log("puzzle changed"),P(),s.width,s.height,h&&h()),288&t.$$.dirty[0]&&(e(8,b),e(5,r),P(),I(r))},[h,g,t=>{const{grid:o,height:e,width:n}=s,{clientX:l,clientY:a}=t,{clientWidth:d,clientHeight:u,offsetLeft:f,offsetTop:h}=g,v=Math.floor((a-h)/u*e),b=Math.floor((l-f)/d*n),w=null==r?void 0:r.get(i);w&&"."!==o[v*n+b]&&O(v,b,null==w?void 0:w.position.dir)&&(c("player-click",{row:v,col:b}),m(p))},t=>{console.log({e:t,state:v});const{row:o,col:n,dir:l}=null==r?void 0:r.get(i).position;if(-1===o||-1===n)return;const{width:d}=s,u=o*d+n,{key:f}=t;switch(f){case U.SPACE:if(!O(o,n,1-l))return;break;case U.BACKSPACE:case U.DELETE:e(6,a[u].value="",a);break;case U.ARROW_DOWN:if(!O(o+1,n,l))return;break;case U.ARROW_UP:if(!O(o-1,n,l))return;break;case U.ARROW_LEFT:if(!O(o,n-1,l))return;break;case U.ARROW_RIGHT:if(!O(o,n+1,l))return;break;default:if(1===f.length){const t=f.charCodeAt(0);if(console.log({code:t}),t<97||t>122)return;e(6,a[u].value=f.toUpperCase(),a),l===z.ACROSS?O(o,n+1,l):O(o+1,n,l)}}c("player-action",f),m(p)},s,r,a,i,b,()=>{h()},function(t){f[t?"unshift":"push"]((()=>{g=t,e(1,g)}))}]}class G extends t{constructor(t){super(),o(this,t,Z,$,e,{cells:6,puzzle:4,playerId:7,playerMap:5},null,[-1,-1])}}const{window:H}=E;function j(t,o,e){const n=t.slice();return n[30]=o[e],n[32]=e,n}function X(t,o,e){const n=t.slice();return n[36]=o[e][0],n[12]=o[e][1],n}function J(t,o,e){const n=t.slice();return n[33]=o[e],n[32]=e,n}function K(t,o,e){const n=t.slice();return n[33]=o[e],n[32]=e,n}function V(t){let o,e=[...t[4]],s=[];for(let n=0;n<e.length;n+=1)s[n]=q(X(t,e,n));return{c(){o=n("div");for(let t=0;t<s.length;t+=1)s[t].c();l(o,"class","crossword-list svelte-1nxfoo6")},m(t,e){a(t,o,e);for(let n=0;n<s.length;n+=1)s[n].m(o,null)},p(t,n){if(16&n[0]){let l;for(e=[...t[4]],l=0;l<e.length;l+=1){const a=X(t,e,l);s[l]?s[l].p(a,n):(s[l]=q(a),s[l].c(),s[l].m(o,null))}for(;l<s.length;l+=1)s[l].d(1);s.length=e.length}},i:i,o:i,d(t){t&&r(o),R(s,t)}}}function Q(t){var o,e,s,i,c,d;let u,f,v,b,w,B,_,E,y,L,D,P,O,z,I,U,k,W,N,M,Y,F,$=(null!=(e=null==(o=t[8])?void 0:o.number)?e:"number")+"",Z=(null!=(i=null==(s=t[8])?void 0:s.text)?i:"text")+"",H=(null!=(d=null==(c=t[8])?void 0:c.length)?d:"length")+"";z=new G({props:{playerId:t[7],playerMap:t[6],puzzle:t[12],cells:t[5]}}),z.$on("player-action",t[15]),z.$on("player-click",t[16]);let j=t[12].acrossClues,X=[];for(let n=0;n<j.length;n+=1)X[n]=tt(K(t,j,n));let V=t[12].downClues,Q=[];for(let n=0;n<V.length;n+=1)Q[n]=ot(J(t,V,n));return{c(){u=n("div"),f=n("span"),v=h($),b=m(),w=n("span"),B=h(Z),_=m(),E=n("span"),y=h("["),L=h(H),D=h("]"),P=m(),O=n("div"),S(z.$$.fragment),I=m(),U=n("div"),k=n("div"),k.textContent="Across",W=m();for(let t=0;t<X.length;t+=1)X[t].c();N=m(),M=n("div"),M.textContent="Down",Y=m();for(let t=0;t<Q.length;t+=1)Q[t].c();l(f,"class","svelte-1nxfoo6"),l(w,"class","svelte-1nxfoo6"),l(E,"class","svelte-1nxfoo6"),l(u,"id","header"),l(u,"class","svelte-1nxfoo6"),l(O,"id","puzzle-container"),l(O,"class","svelte-1nxfoo6"),l(k,"class","clue-header svelte-1nxfoo6"),l(M,"class","clue-header svelte-1nxfoo6"),l(U,"id","clues"),l(U,"class","svelte-1nxfoo6")},m(t,o){a(t,u,o),g(u,f),g(f,v),g(u,b),g(u,w),g(w,B),g(u,_),g(u,E),g(E,y),g(E,L),g(E,D),a(t,P,o),a(t,O,o),C(z,O,null),a(t,I,o),a(t,U,o),g(U,k),g(U,W);for(let e=0;e<X.length;e+=1)X[e].m(U,null);g(U,N),g(U,M),g(U,Y);for(let e=0;e<Q.length;e+=1)Q[e].m(U,null);F=!0},p(t,o){var e,n,l,a,s,i;(!F||256&o[0])&&$!==($=(null!=(n=null==(e=t[8])?void 0:e.number)?n:"number")+"")&&p(v,$),(!F||256&o[0])&&Z!==(Z=(null!=(a=null==(l=t[8])?void 0:l.text)?a:"text")+"")&&p(B,Z),(!F||256&o[0])&&H!==(H=(null!=(i=null==(s=t[8])?void 0:s.length)?i:"length")+"")&&p(L,H);const r={};if(128&o[0]&&(r.playerId=t[7]),64&o[0]&&(r.playerMap=t[6]),4096&o[0]&&(r.puzzle=t[12]),32&o[0]&&(r.cells=t[5]),z.$set(r),4096&o[0]){let e;for(j=t[12].acrossClues,e=0;e<j.length;e+=1){const n=K(t,j,e);X[e]?X[e].p(n,o):(X[e]=tt(n),X[e].c(),X[e].m(U,N))}for(;e<X.length;e+=1)X[e].d(1);X.length=j.length}if(4096&o[0]){let e;for(V=t[12].downClues,e=0;e<V.length;e+=1){const n=J(t,V,e);Q[e]?Q[e].p(n,o):(Q[e]=ot(n),Q[e].c(),Q[e].m(U,null))}for(;e<Q.length;e+=1)Q[e].d(1);Q.length=V.length}},i(t){F||(A(z.$$.fragment,t),F=!0)},o(t){x(z.$$.fragment,t),F=!1},d(t){t&&r(u),t&&r(P),t&&r(O),T(z),t&&r(I),t&&r(U),R(X,t),R(Q,t)}}}function q(t){let o,e,s,i,c,d,u,f,v=t[12].title+"",b=new Date(t[12].date).toLocaleDateString(void 0,{weekday:"short",year:"numeric",month:"numeric",day:"numeric"})+"";return{c(){o=n("div"),e=h("“"),s=h(v),i=h("”"),c=m(),d=n("div"),u=h(b),f=m(),l(o,"class","title svelte-1nxfoo6"),l(d,"class","date svelte-1nxfoo6")},m(t,n){a(t,o,n),g(o,e),g(o,s),g(o,i),a(t,c,n),a(t,d,n),g(d,u),g(d,f)},p(t,o){16&o[0]&&v!==(v=t[12].title+"")&&p(s,v),16&o[0]&&b!==(b=new Date(t[12].date).toLocaleDateString(void 0,{weekday:"short",year:"numeric",month:"numeric",day:"numeric"})+"")&&p(u,b)},d(t){t&&r(o),t&&r(c),t&&r(d)}}}function tt(t){let o,e,s,i,c,d,u=t[33].number+"",f=t[33].text+"";return{c(){o=n("div"),e=h(u),s=h("."),i=m(),c=n("div"),d=h(f),l(o,"class","clue-number svelte-1nxfoo6"),l(c,"class","clue-text svelte-1nxfoo6")},m(t,n){a(t,o,n),g(o,e),g(o,s),a(t,i,n),a(t,c,n),g(c,d)},p(t,o){4096&o[0]&&u!==(u=t[33].number+"")&&p(e,u),4096&o[0]&&f!==(f=t[33].text+"")&&p(d,f)},d(t){t&&r(o),t&&r(i),t&&r(c)}}}function ot(t){let o,e,s,i,c,d,u=t[33].number+"",f=t[33].text+"";return{c(){o=n("div"),e=h(u),s=h("."),i=m(),c=n("div"),d=h(f),l(o,"class","clue-number svelte-1nxfoo6"),l(c,"class","clue-text svelte-1nxfoo6")},m(t,n){a(t,o,n),g(o,e),g(o,s),a(t,i,n),a(t,c,n),g(c,d)},p(t,o){4096&o[0]&&u!==(u=t[33].number+"")&&p(e,u),4096&o[0]&&f!==(f=t[33].text+"")&&p(d,f)},d(t){t&&r(o),t&&r(i),t&&r(c)}}}function et(t){let o,e,l,s,i=t[30]+"";return{c(){o=n("div"),e=h(t[32]),l=h(": "),s=h(i)},m(t,n){a(t,o,n),g(o,e),g(o,l),g(o,s)},p(t,o){8&o[0]&&i!==(i=t[30]+"")&&p(s,i)},d(t){t&&r(o)}}}function nt(t){let o,e,i,d,u,f,h,p,E,S,C,T,L,D,P,O,z,I,U,k,N,M,Y,F,$,Z,G,X;const J=[Q,V],K=[];function q(t,o){return t[2]===W.CROSSWORD?0:1}i=q(t),d=K[i]=J[i](t);let tt=t[3],ot=[];for(let n=0;n<tt.length;n+=1)ot[n]=et(j(t,tt,n));return{c(){o=n("main"),e=n("div"),d.c(),u=m(),f=n("div"),h=n("div");for(let t=0;t<ot.length;t+=1)ot[t].c();p=m(),E=n("button"),E.textContent="WSJ Puzzle",S=m(),C=n("button"),C.textContent="Get",T=m(),L=n("button"),L.textContent="Get #",D=m(),P=n("button"),P.textContent="Load",O=m(),z=n("input"),I=m(),U=n("input"),k=m(),N=n("input"),M=m(),Y=n("button"),Y.textContent="Send",F=m(),$=n("input"),l(h,"id","log"),v(h,"display","flex"),l(h,"class","svelte-1nxfoo6"),l(E,"class","svelte-1nxfoo6"),l(C,"class","svelte-1nxfoo6"),l(L,"class","svelte-1nxfoo6"),l(P,"class","svelte-1nxfoo6"),l(z,"id","date-year"),l(z,"placeholder","YYYY"),l(z,"type","number"),l(z,"inputmode","numeric"),l(z,"pattern","[0-9]*"),l(z,"class","svelte-1nxfoo6"),l(U,"id","date-month"),l(U,"placeholder","MM"),l(U,"type","number"),l(U,"inputmode","numeric"),l(U,"pattern","[0-9]*"),l(U,"class","svelte-1nxfoo6"),l(N,"id","date-day"),l(N,"placeholder","DD"),l(N,"type","number"),l(N,"inputmode","numeric"),l(N,"pattern","[0-9]*"),l(N,"class","svelte-1nxfoo6"),l(Y,"class","svelte-1nxfoo6"),l($,"type","text"),l($,"class","svelte-1nxfoo6"),l(f,"id","controls"),l(f,"class","svelte-1nxfoo6"),l(o,"class","svelte-1nxfoo6")},m(n,l){a(n,o,l),g(o,e),K[i].m(e,null),g(o,u),g(o,f),g(f,h);for(let t=0;t<ot.length;t+=1)ot[t].m(h,null);g(f,p),g(f,E),g(f,S),g(f,C),g(f,T),g(f,L),g(f,D),g(f,P),g(f,O),g(f,z),b(z,t[9]),g(f,I),g(f,U),b(U,t[10]),g(f,k),g(f,N),b(N,t[11]),g(f,M),g(f,Y),g(f,F),g(f,$),b($,t[1]),Z=!0,G||(X=[s(H,"beforeunload",t[14]),s(E,"click",t[17]),s(C,"click",t[18]),s(L,"click",t[19]),s(P,"click",t[20]),s(z,"input",t[21]),s(U,"input",t[22]),s(N,"input",t[23]),s(Y,"click",t[24]),s($,"input",t[25]),s(f,"keydown",w(lt))],G=!0)},p(t,o){let n=i;if(i=q(t),i===n?K[i].p(t,o):(y(),x(K[n],1,1,(()=>{K[n]=null})),B(),d=K[i],d?d.p(t,o):(d=K[i]=J[i](t),d.c()),A(d,1),d.m(e,null)),8&o[0]){let e;for(tt=t[3],e=0;e<tt.length;e+=1){const n=j(t,tt,e);ot[e]?ot[e].p(n,o):(ot[e]=et(n),ot[e].c(),ot[e].m(h,null))}for(;e<ot.length;e+=1)ot[e].d(1);ot.length=tt.length}512&o[0]&&_(z.value)!==t[9]&&b(z,t[9]),1024&o[0]&&_(U.value)!==t[10]&&b(U,t[10]),2048&o[0]&&_(N.value)!==t[11]&&b(N,t[11]),2&o[0]&&$.value!==t[1]&&b($,t[1])},i(t){Z||(A(d),Z=!0)},o(t){x(d),Z=!1},d(t){t&&r(o),K[i].d(),R(ot,t),G=!1,c(X)}}}const lt=()=>{};function at(t,o,e){var n=this&&this.__awaiter||function(t,o,e,n){return new(e||(e=Promise))((function(l,a){function s(t){try{r(n.next(t))}catch(o){a(o)}}function i(t){try{r(n.throw(t))}catch(o){a(o)}}function r(t){var o;t.done?l(t.value):(o=t.value,o instanceof e?o:new e((function(t){t(o)}))).then(s,i)}r((n=n.apply(t,o||[])).next())}))};let l,a,s="",i=W.LIST,r=[],c=new Map(JSON.parse(localStorage.getItem("crosswords"))),d={acrossClues:[],attribution:"",creators:"",downClues:[],grid:"Q",height:1,id:"",title:"",width:1},u=[{isCell:!1,solution:"Q",value:""}],f="",h=d.acrossClues[0];console.log(i);let g=2021,p=7,m=30;const v=t=>n(void 0,void 0,void 0,(function*(){console.log(t);const o=yield t.data.text(),n=JSON.parse(o),{tag:l,data:s}=n;switch(l){case L.Text:e(3,r=[...r,s]),console.log(s);break;case L.Puzzle:e(12,d=s),e(12,d),e(5,u=Array(d.grid.length));for(let n=0;n<u.length;n++){const t="."!==d.grid[n];e(5,u[n]={isCell:t,solution:d.grid[n],value:t?"":"."},u)}break;case L.State:console.log({data:s});break;case L.Register:e(7,f=s.id),console.log({playerId:f});break;case L.NEW_PUZZLE:const t=s;for(const e of t)c.has(e.id)||c.set(e.id,{id:e.id,source:e.source,date:new Date(e.year,e.month-1,e.day),title:e.title,state:e.state,completion:e.completion});console.log({puzzleMap:c}),e(4,c),localStorage.setItem("crosswords",JSON.stringify([...c]));break;case L.PLAYER_UPDATE:const{state:o,players:i}=s;console.log(o),console.log(n);for(let n=0;n<u.length&&n<o.length;n++){const t=0===o[n].charCodeAt(0);e(5,u[n].value=t?"":o[n],u)}e(6,a=new Map(Object.entries(i))),console.log(a),console.log(Array.from(a.values())),console.log(f),""!==f&&console.log(null==a?void 0:a.get(f).position);break;default:console.log(`Undefined message tag: ${l}.`),console.log(s)}})),b=()=>{window.WebSocket?(e(0,l=new WebSocket("ws://localhost:8080/ws"+document.location.pathname)),e(0,l.onopen=t=>{console.log("Socket opened.")},l),e(0,l.onclose=t=>{console.log("Connection closed. An attempt to reconnect will be made in 1 second.",t.reason),setTimeout(b,1e3)},l),e(0,l.onmessage=v,l)):console.log("Your browser does not support WebSockets.")},w=(t,o)=>{l&&l.send(JSON.stringify({tag:t,data:o}))};b();return[l,s,i,r,c,u,a,f,h,g,p,m,d,w,()=>{l&&l.close()},t=>{console.log({e:t}),w(L.PLAYER_ACTION,t.detail);const o=null==a?void 0:a.get(f);o&&e(8,h=M(d,o.position))},t=>{w(L.PLAYER_CLICK,t.detail);const o=null==a?void 0:a.get(f);o&&e(8,h=M(d,o.position))},()=>{w(L.Puzzle,{sources:["wsj"],day:30,month:7,year:2021})},()=>{w(L.NEW_PUZZLE,{sources:["wsj"],day:30,month:7,year:2021})},()=>{w(L.NEW_PUZZLE,{sources:["wsj"],day:m,month:p,year:g})},()=>{if(!d.id)return;const t=localStorage.getItem(d.id);t&&(w(L.PUZZLE_LOAD,{id:d.id,state:t}),e(2,i=W.CROSSWORD))},function(){g=_(this.value),e(9,g)},function(){p=_(this.value),e(10,p)},function(){m=_(this.value),e(11,m)},()=>{l&&s&&(w(L.Text,s),e(1,s=""))},function(){s=this.value,e(1,s)}]}new class extends t{constructor(t){super(),o(this,t,at,nt,e,{},null,[-1,-1])}}({target:document.getElementById("app")});
